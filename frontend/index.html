<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle Multijoueur</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.3s ease-in-out; }
        @keyframes flip {
            0% { transform: rotateX(0); }
            50% { transform: rotateX(90deg); }
            100% { transform: rotateX(0); }
        }
        .flip { animation: flip 0.5s ease-in-out; }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .pop { animation: pop 0.1s ease-in-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const API_URL = 'http://localhost:8000';

        const api = {
            async register(email, nom, prenom, password) {
                const res = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, nom, prenom, password })
                });
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.detail);
                }
                return res.json();
            },
            async login(email, password) {
                const res = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.detail);
                }
                return res.json();
            },
            async getStats(email) {
                const res = await fetch(`${API_URL}/stats/${email}`);
                return res.json();
            },
            async createLobby(nom, email) {
                const res = await fetch(`${API_URL}/lobby/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nom, email })
                });
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.detail);
                }
                return res.json();
            },
            async joinLobby(code, email) {
                const res = await fetch(`${API_URL}/lobby/join`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code, email })
                });
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.detail);
                }
                return res.json();
            },
            async getLobby(code) {
                const res = await fetch(`${API_URL}/lobby/${code}`);
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.detail);
                }
                return res.json();
            },
            async startGame(email, lobbyCode) {
                const res = await fetch(`${API_URL}/game/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, lobby_code: lobbyCode })
                });
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.detail);
                }
                return res.json();
            },
            async submitGuess(gameId, guess, email) {
                const res = await fetch(`${API_URL}/game/guess`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ game_id: gameId, guess, email })
                });
                if (!res.ok) {
                    const err = await res.json();
                    throw new Error(err.detail);
                }
                return res.json();
            }
        };

        const WordleApp = () => {
            const [page, setPage] = React.useState('home');
            const [user, setUser] = React.useState(null);
            const [lobby, setLobby] = React.useState(null);
            const [gameId, setGameId] = React.useState(null);
            const [wordLength, setWordLength] = React.useState(5);
            const [tentatives, setTentatives] = React.useState([]);
            const [currentGuess, setCurrentGuess] = React.useState('');
            const [message, setMessage] = React.useState('');
            const [messageType, setMessageType] = React.useState('info');
            const [stats, setStats] = React.useState({ victoires: 0, parties: 0, meilleurScore: 0 });
            const [gameOver, setGameOver] = React.useState(false);
            const [loading, setLoading] = React.useState(false);

            React.useEffect(() => {
                const savedUser = localStorage.getItem('wordleUser');
                if (savedUser) {
                    const parsed = JSON.parse(savedUser);
                    setUser(parsed);
                    loadStats(parsed.email);
                    setPage('menu');
                }
            }, []);

            const loadStats = async (email) => {
                try {
                    const data = await api.getStats(email);
                    setStats(data);
                } catch (error) {
                    console.log('Error loading stats');
                }
            };

            const showMessage = (msg, type = 'info') => {
                setMessage(msg);
                setMessageType(type);
                setTimeout(() => setMessage(''), 3000);
            };

            const handleRegister = async (email, nom, prenom, password) => {
                setLoading(true);
                try {
                    const userData = await api.register(email, nom, prenom, password);
                    localStorage.setItem('wordleUser', JSON.stringify(userData));
                    setUser(userData);
                    setPage('menu');
                    showMessage(`Bienvenue ${prenom}!`, 'success');
                } catch (error) {
                    showMessage(error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleLogin = async (email, password) => {
                setLoading(true);
                try {
                    const userData = await api.login(email, password);
                    localStorage.setItem('wordleUser', JSON.stringify(userData));
                    setUser(userData);
                    await loadStats(userData.email);
                    setPage('menu');
                    showMessage(`Bon retour ${userData.prenom}!`, 'success');
                } catch (error) {
                    showMessage(error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleLogout = () => {
                localStorage.removeItem('wordleUser');
                setUser(null);
                setLobby(null);
                setPage('home');
            };

            const handleCreateLobby = async (nomLobby) => {
                setLoading(true);
                try {
                    const lobbyData = await api.createLobby(nomLobby, user.email);
                    setLobby(lobbyData);
                    setPage('lobby');
                    showMessage(`Lobby cree! Code: ${lobbyData.code}`, 'success');
                } catch (error) {
                    showMessage(error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleJoinLobby = async (code) => {
                setLoading(true);
                try {
                    const lobbyData = await api.joinLobby(code, user.email);
                    setLobby(lobbyData);
                    setPage('lobby');
                    showMessage('Lobby rejoint!', 'success');
                } catch (error) {
                    showMessage(error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const refreshLobby = async () => {
                if (lobby) {
                    try {
                        const lobbyData = await api.getLobby(lobby.code);
                        setLobby(lobbyData);
                    } catch (error) {
                        console.log('Error refreshing lobby');
                    }
                }
            };

            const handleStartGame = async () => {
                setLoading(true);
                try {
                    const gameData = await api.startGame(user.email, lobby.code);
                    setGameId(gameData.game_id);
                    setWordLength(gameData.longueur);
                    setTentatives([]);
                    setCurrentGuess('');
                    setGameOver(false);
                    setPage('jeu');
                } catch (error) {
                    showMessage(error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleSubmitGuess = async () => {
                if (currentGuess.length !== wordLength) {
                    showMessage(`Le mot doit faire ${wordLength} lettres!`, 'error');
                    return;
                }

                setLoading(true);
                try {
                    const result = await api.submitGuess(gameId, currentGuess, user.email);
                    const newTentative = {
                        mot: currentGuess.toUpperCase(),
                        correction: result.correction.map(c => c.etat)
                    };
                    setTentatives([...tentatives, newTentative]);
                    setCurrentGuess('');

                    if (result.gagne) {
                        setGameOver(true);
                        await loadStats(user.email);
                        await refreshLobby();
                        showMessage(`Bravo! Trouve en ${tentatives.length + 1} essais! +${result.score} points`, 'success');
                    } else if (result.perdu) {
                        setGameOver(true);
                        await loadStats(user.email);
                        showMessage(`Perdu! Le mot etait: ${result.mot_secret}`, 'error');
                    }
                } catch (error) {
                    showMessage(error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const handleKeyPress = (lettre) => {
                if (gameOver || loading) return;

                if (lettre === 'ENTER') {
                    handleSubmitGuess();
                } else if (lettre === 'BACK') {
                    setCurrentGuess(prev => prev.slice(0, -1));
                } else if (currentGuess.length < wordLength) {
                    setCurrentGuess(prev => prev + lettre);
                }
            };

            // Handle physical keyboard
            React.useEffect(() => {
                const handleKeyDown = (e) => {
                    if (page !== 'jeu' || gameOver) return;

                    if (e.key === 'Enter') {
                        handleKeyPress('ENTER');
                    } else if (e.key === 'Backspace') {
                        handleKeyPress('BACK');
                    } else if (/^[a-zA-Z]$/.test(e.key)) {
                        handleKeyPress(e.key.toUpperCase());
                    }
                };

                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [page, gameOver, currentGuess, wordLength, tentatives, gameId, user]);

            // Components
            const HomePage = () => (
                <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                        <div className="text-center mb-8">
                            <h1 className="text-5xl font-bold text-gray-800 mb-2">WORDLE</h1>
                            <p className="text-gray-600">Multijoueur</p>
                        </div>

                        <div className="space-y-4">
                            <button
                                onClick={() => setPage('register')}
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg flex items-center justify-center gap-2 transition"
                            >
                                S'inscrire
                            </button>

                            <button
                                onClick={() => setPage('login')}
                                className="w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg flex items-center justify-center gap-2 transition"
                            >
                                Se connecter
                            </button>
                        </div>
                    </div>
                </div>
            );

            const RegisterPage = () => {
                const [formData, setFormData] = React.useState({ email: '', nom: '', prenom: '', password: '' });

                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-600 to-teal-700 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6">Inscription</h2>

                            <div className="space-y-4">
                                <input
                                    type="email"
                                    placeholder="Email"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none"
                                />
                                <input
                                    type="text"
                                    placeholder="Nom"
                                    value={formData.nom}
                                    onChange={(e) => setFormData({...formData, nom: e.target.value})}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none"
                                />
                                <input
                                    type="text"
                                    placeholder="Prenom"
                                    value={formData.prenom}
                                    onChange={(e) => setFormData({...formData, prenom: e.target.value})}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none"
                                />
                                <input
                                    type="password"
                                    placeholder="Mot de passe"
                                    value={formData.password}
                                    onChange={(e) => setFormData({...formData, password: e.target.value})}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none"
                                />

                                <button
                                    onClick={() => formData.email && formData.nom && formData.prenom && formData.password && handleRegister(formData.email, formData.nom, formData.prenom, formData.password)}
                                    disabled={loading}
                                    className="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-semibold py-3 rounded-lg transition"
                                >
                                    {loading ? 'Chargement...' : 'Creer mon compte'}
                                </button>
                            </div>

                            <button
                                onClick={() => setPage('home')}
                                className="w-full mt-4 text-gray-600 hover:text-gray-800"
                            >
                                Retour
                            </button>
                        </div>
                    </div>
                );
            };

            const LoginPage = () => {
                const [formData, setFormData] = React.useState({ email: '', password: '' });

                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6">Connexion</h2>

                            <div className="space-y-4">
                                <input
                                    type="email"
                                    placeholder="Email"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                />
                                <input
                                    type="password"
                                    placeholder="Mot de passe"
                                    value={formData.password}
                                    onChange={(e) => setFormData({...formData, password: e.target.value})}
                                    onKeyPress={(e) => e.key === 'Enter' && formData.email && formData.password && handleLogin(formData.email, formData.password)}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                />

                                <button
                                    onClick={() => formData.email && formData.password && handleLogin(formData.email, formData.password)}
                                    disabled={loading}
                                    className="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-semibold py-3 rounded-lg transition"
                                >
                                    {loading ? 'Chargement...' : 'Se connecter'}
                                </button>
                            </div>

                            <button
                                onClick={() => setPage('home')}
                                className="w-full mt-4 text-gray-600 hover:text-gray-800"
                            >
                                Retour
                            </button>
                        </div>
                    </div>
                );
            };

            const MenuPage = () => (
                <div className="min-h-screen bg-gradient-to-br from-purple-600 to-pink-700 p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 mb-6">
                            <div className="flex items-center justify-between mb-6">
                                <div>
                                    <h2 className="text-3xl font-bold text-gray-800">Bienvenue {user?.prenom}!</h2>
                                    <p className="text-gray-600">{user?.email}</p>
                                </div>
                                <button
                                    onClick={handleLogout}
                                    className="text-red-600 hover:text-red-800 font-semibold"
                                >
                                    Deconnexion
                                </button>
                            </div>

                            <div className="grid grid-cols-3 gap-4 mb-6">
                                <div className="bg-blue-100 p-4 rounded-lg text-center">
                                    <div className="text-3xl mb-2">üèÜ</div>
                                    <div className="text-2xl font-bold text-gray-800">{stats.victoires}</div>
                                    <div className="text-sm text-gray-600">Victoires</div>
                                </div>
                                <div className="bg-green-100 p-4 rounded-lg text-center">
                                    <div className="text-3xl mb-2">üéÆ</div>
                                    <div className="text-2xl font-bold text-gray-800">{stats.parties}</div>
                                    <div className="text-sm text-gray-600">Parties</div>
                                </div>
                                <div className="bg-yellow-100 p-4 rounded-lg text-center">
                                    <div className="text-3xl mb-2">‚≠ê</div>
                                    <div className="text-2xl font-bold text-gray-800">{stats.meilleurScore}</div>
                                    <div className="text-sm text-gray-600">Meilleur Score</div>
                                </div>
                            </div>
                        </div>

                        <div className="grid md:grid-cols-2 gap-6">
                            <button
                                onClick={() => setPage('createLobby')}
                                className="bg-white hover:bg-gray-50 rounded-2xl shadow-lg p-8 text-center transition"
                            >
                                <div className="text-5xl mb-4">üë•</div>
                                <h3 className="text-2xl font-bold text-gray-800 mb-2">Creer un Lobby</h3>
                                <p className="text-gray-600">Invitez vos amis a jouer</p>
                            </button>

                            <button
                                onClick={() => setPage('joinLobby')}
                                className="bg-white hover:bg-gray-50 rounded-2xl shadow-lg p-8 text-center transition"
                            >
                                <div className="text-5xl mb-4">üöÄ</div>
                                <h3 className="text-2xl font-bold text-gray-800 mb-2">Rejoindre un Lobby</h3>
                                <p className="text-gray-600">Entrez un code de lobby</p>
                            </button>
                        </div>
                    </div>
                </div>
            );

            const CreateLobbyPage = () => {
                const [nomLobby, setNomLobby] = React.useState('');

                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-600 to-blue-700 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6">Creer un Lobby</h2>

                            <input
                                type="text"
                                placeholder="Nom du lobby"
                                value={nomLobby}
                                onChange={(e) => setNomLobby(e.target.value)}
                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none mb-4"
                            />

                            <button
                                onClick={() => nomLobby && handleCreateLobby(nomLobby)}
                                disabled={loading}
                                className="w-full bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 text-white font-semibold py-3 rounded-lg transition mb-4"
                            >
                                {loading ? 'Chargement...' : 'Creer'}
                            </button>

                            <button
                                onClick={() => setPage('menu')}
                                className="w-full text-gray-600 hover:text-gray-800"
                            >
                                Retour
                            </button>
                        </div>
                    </div>
                );
            };

            const JoinLobbyPage = () => {
                const [code, setCode] = React.useState('');

                return (
                    <div className="min-h-screen bg-gradient-to-br from-teal-600 to-green-700 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6">Rejoindre un Lobby</h2>

                            <input
                                type="text"
                                placeholder="Code du lobby (6 chiffres)"
                                value={code}
                                onChange={(e) => setCode(e.target.value)}
                                maxLength={6}
                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-teal-500 focus:outline-none mb-4 text-center text-2xl tracking-widest"
                            />

                            <button
                                onClick={() => code.length === 6 && handleJoinLobby(code)}
                                disabled={loading}
                                className="w-full bg-teal-600 hover:bg-teal-700 disabled:bg-gray-400 text-white font-semibold py-3 rounded-lg transition mb-4"
                            >
                                {loading ? 'Chargement...' : 'Rejoindre'}
                            </button>

                            <button
                                onClick={() => setPage('menu')}
                                className="w-full text-gray-600 hover:text-gray-800"
                            >
                                Retour
                            </button>
                        </div>
                    </div>
                );
            };

            const LobbyPage = () => (
                <div className="min-h-screen bg-gradient-to-br from-orange-600 to-red-700 p-4">
                    <div className="max-w-2xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-2xl p-8">
                            <div className="mb-6">
                                <h2 className="text-3xl font-bold text-gray-800 mb-2">{lobby.nom}</h2>
                                <div className="text-xl font-mono bg-gray-100 p-3 rounded-lg text-center">
                                    Code: <span className="font-bold text-orange-600">{lobby.code}</span>
                                </div>
                            </div>

                            <div className="mb-6">
                                <div className="flex justify-between items-center mb-3">
                                    <h3 className="text-xl font-bold text-gray-700">Joueurs ({lobby.joueurs.length})</h3>
                                    <button
                                        onClick={refreshLobby}
                                        className="text-orange-600 hover:text-orange-800 text-sm"
                                    >
                                        Actualiser
                                    </button>
                                </div>
                                <div className="space-y-2">
                                    {lobby.joueurs.map((joueur, idx) => (
                                        <div key={idx} className="bg-gray-50 p-3 rounded-lg flex justify-between items-center">
                                            <span className="font-semibold">
                                                {joueur.nom}
                                                {joueur.email === lobby.createur && <span className="text-xs text-orange-600 ml-2">(Hote)</span>}
                                            </span>
                                            <span className="text-orange-600 font-bold">{joueur.score} pts</span>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <button
                                onClick={handleStartGame}
                                disabled={loading}
                                className="w-full bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white font-semibold py-3 rounded-lg flex items-center justify-center gap-2 transition mb-4"
                            >
                                {loading ? 'Chargement...' : 'Demarrer la partie'}
                            </button>

                            <button
                                onClick={() => {
                                    setLobby(null);
                                    setPage('menu');
                                }}
                                className="w-full text-gray-600 hover:text-gray-800"
                            >
                                Quitter le lobby
                            </button>
                        </div>
                    </div>
                </div>
            );

            const JeuPage = () => {
                const clavier = [
                    ['A', 'Z', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
                    ['Q', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L', 'M'],
                    ['ENTER', 'W', 'X', 'C', 'V', 'B', 'N', 'BACK']
                ];

                // Build letter status map from all attempts
                const getLetterStatus = () => {
                    const status = {};
                    tentatives.forEach(t => {
                        t.mot.split('').forEach((lettre, idx) => {
                            const etat = t.correction[idx];
                            if (etat === 'correct') {
                                status[lettre] = 'correct';
                            } else if (etat === 'present' && status[lettre] !== 'correct') {
                                status[lettre] = 'present';
                            } else if (etat === 'absent' && !status[lettre]) {
                                status[lettre] = 'absent';
                            }
                        });
                    });
                    return status;
                };

                const letterStatus = getLetterStatus();

                const getKeyColor = (lettre) => {
                    if (lettre === 'ENTER' || lettre === 'BACK') return 'bg-gray-400 hover:bg-gray-500';
                    const status = letterStatus[lettre];
                    if (status === 'correct') return 'bg-green-500 text-white';
                    if (status === 'present') return 'bg-yellow-500 text-white';
                    if (status === 'absent') return 'bg-gray-600 text-white';
                    return 'bg-gray-300 hover:bg-gray-400';
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-700 to-slate-900 p-4">
                        <div className="max-w-lg mx-auto">
                            <div className="bg-white rounded-2xl shadow-2xl p-6 mb-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-bold text-gray-800">WORDLE</h2>
                                    <div className="text-sm text-gray-600">
                                        Essai {Math.min(tentatives.length + 1, 6)}/6
                                    </div>
                                </div>

                                <div className="space-y-2 mb-6">
                                    {[...Array(6)].map((_, rowIdx) => (
                                        <div key={rowIdx} className="flex gap-2 justify-center">
                                            {[...Array(wordLength)].map((_, colIdx) => {
                                                const tentative = tentatives[rowIdx];
                                                const isCurrentRow = rowIdx === tentatives.length;
                                                const lettre = tentative ? tentative.mot[colIdx] : (isCurrentRow ? currentGuess[colIdx] : '') || '';
                                                const etat = tentative ? tentative.correction[colIdx] : '';

                                                return (
                                                    <div
                                                        key={colIdx}
                                                        className={`w-14 h-14 border-2 rounded flex items-center justify-center text-2xl font-bold transition-all
                                                            ${etat === 'correct' ? 'bg-green-500 text-white border-green-500' : ''}
                                                            ${etat === 'present' ? 'bg-yellow-500 text-white border-yellow-500' : ''}
                                                            ${etat === 'absent' ? 'bg-gray-400 text-white border-gray-400' : ''}
                                                            ${!etat && lettre ? 'border-gray-400 pop' : 'border-gray-300'}
                                                        `}
                                                    >
                                                        {lettre}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    ))}
                                </div>

                                {gameOver && (
                                    <div className="mb-4 p-4 bg-blue-100 rounded-lg text-center">
                                        <button
                                            onClick={() => {
                                                refreshLobby();
                                                setPage('lobby');
                                            }}
                                            className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg"
                                        >
                                            Retour au lobby
                                        </button>
                                    </div>
                                )}
                            </div>

                            <div className="bg-white rounded-2xl shadow-2xl p-4">
                                <div className="space-y-2">
                                    {clavier.map((row, idx) => (
                                        <div key={idx} className="flex gap-1 justify-center">
                                            {row.map((lettre) => (
                                                <button
                                                    key={lettre}
                                                    onClick={() => handleKeyPress(lettre)}
                                                    disabled={gameOver || loading}
                                                    className={`
                                                        ${lettre === 'ENTER' || lettre === 'BACK' ? 'px-3 text-xs' : 'w-9'}
                                                        h-12 font-semibold rounded transition
                                                        ${getKeyColor(lettre)}
                                                        disabled:opacity-50 disabled:cursor-not-allowed
                                                    `}
                                                >
                                                    {lettre === 'BACK' ? '‚å´' : lettre}
                                                </button>
                                            ))}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="relative">
                    {message && (
                        <div className={`fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 font-semibold
                            ${messageType === 'success' ? 'bg-green-600 text-white' : ''}
                            ${messageType === 'error' ? 'bg-red-600 text-white' : ''}
                            ${messageType === 'info' ? 'bg-gray-800 text-white' : ''}
                        `}>
                            {message}
                        </div>
                    )}

                    {page === 'home' && <HomePage />}
                    {page === 'register' && <RegisterPage />}
                    {page === 'login' && <LoginPage />}
                    {page === 'menu' && <MenuPage />}
                    {page === 'createLobby' && <CreateLobbyPage />}
                    {page === 'joinLobby' && <JoinLobbyPage />}
                    {page === 'lobby' && <LobbyPage />}
                    {page === 'jeu' && <JeuPage />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WordleApp />);
    </script>
</body>
</html>
