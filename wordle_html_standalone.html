<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle Multijoueur</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const MOTS_DISPONIBLES = [
            "ARBRE", "BOIRE", "CHIEN", "DROIT", "ECOLE", 
            "FLEUR", "GRAND", "HIVER", "JOUER", "LIVRE",
            "MAGIE", "NAGER", "ORDRE", "PAINS", "RONDE",
            "TEMPS", "UTILE", "VENIR", "WAGON", "ZONES"
        ];

        // Syst√®me de stockage simplifi√© en localStorage
        const storage = {
            get: (key) => {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            },
            set: (key, value) => {
                localStorage.setItem(key, JSON.stringify(value));
            }
        };

        const WordleApp = () => {
            const [page, setPage] = useState('home');
            const [user, setUser] = useState(null);
            const [lobby, setLobby] = useState(null);
            const [partie, setPartie] = useState(null);
            const [tentatives, setTentatives] = useState([]);
            const [currentGuess, setCurrentGuess] = useState('');
            const [message, setMessage] = useState('');
            const [stats, setStats] = useState({ victoires: 0, parties: 0, meilleurScore: 0 });
            const [gameOver, setGameOver] = useState(false);

            useEffect(() => {
                loadUserData();
            }, []);

            const loadUserData = () => {
                const userData = storage.get('currentUser');
                if (userData) {
                    setUser(userData);
                    loadStats(userData.email);
                }
            };

            const loadStats = (email) => {
                const statsData = storage.get(`stats:${email}`);
                if (statsData) {
                    setStats(statsData);
                }
            };

            const saveStats = (email, newStats) => {
                storage.set(`stats:${email}`, newStats);
                setStats(newStats);
            };

            const showMessage = (msg) => {
                setMessage(msg);
                setTimeout(() => setMessage(''), 3000);
            };

            const registerUser = (email, nom, prenom) => {
                const newUser = { email, nom, prenom };
                storage.set('currentUser', newUser);
                setUser(newUser);
                setPage('menu');
                showMessage(`Bienvenue ${prenom} ${nom}!`);
            };

            const createLobby = (nomLobby) => {
                const code = Math.floor(100000 + Math.random() * 900000).toString();
                const newLobby = {
                    code,
                    nom: nomLobby,
                    createur: user.email,
                    joueurs: [{ email: user.email, nom: user.nom, score: 0 }]
                };
                
                storage.set(`lobby:${code}`, newLobby);
                setLobby(newLobby);
                setPage('lobby');
                showMessage(`Lobby cr√©√©! Code: ${code}`);
            };

            const joinLobby = (code) => {
                const existingLobby = storage.get(`lobby:${code}`);
                if (!existingLobby) {
                    showMessage('Lobby introuvable!');
                    return;
                }
                
                const alreadyJoined = existingLobby.joueurs.some(j => j.email === user.email);
                
                if (!alreadyJoined) {
                    existingLobby.joueurs.push({ email: user.email, nom: user.nom, score: 0 });
                    storage.set(`lobby:${code}`, existingLobby);
                }
                
                setLobby(existingLobby);
                setPage('lobby');
                showMessage('Lobby rejoint!');
            };

            const startPartie = () => {
                const motSecret = MOTS_DISPONIBLES[Math.floor(Math.random() * MOTS_DISPONIBLES.length)];
                const newPartie = {
                    motSecret,
                    longueur: motSecret.length,
                    termine: false,
                    gagnant: null
                };
                
                setPartie(newPartie);
                setTentatives([]);
                setCurrentGuess('');
                setGameOver(false);
                setPage('jeu');
            };

            const corrigerGuess = (motSecret, guess) => {
                const result = [];
                const lettresSecrets = motSecret.split('');
                const guessUpper = guess.toUpperCase();
                const lettresUtilisees = [...lettresSecrets];
                
                for (let i = 0; i < guessUpper.length; i++) {
                    if (guessUpper[i] === lettresSecrets[i]) {
                        result[i] = 'correct';
                        lettresUtilisees[i] = null;
                    }
                }
                
                for (let i = 0; i < guessUpper.length; i++) {
                    if (!result[i]) {
                        const idx = lettresUtilisees.indexOf(guessUpper[i]);
                        if (idx !== -1) {
                            result[i] = 'present';
                            lettresUtilisees[idx] = null;
                        } else {
                            result[i] = 'absent';
                        }
                    }
                }
                
                return result;
            };

            const submitGuess = () => {
                if (currentGuess.length !== partie.longueur) {
                    showMessage(`Le mot doit faire ${partie.longueur} lettres!`);
                    return;
                }

                const correction = corrigerGuess(partie.motSecret, currentGuess);
                const newTentatives = [...tentatives, { mot: currentGuess.toUpperCase(), correction }];
                setTentatives(newTentatives);
                setCurrentGuess('');

                const gagne = correction.every(c => c === 'correct');
                
                if (gagne) {
                    const score = Math.max(0, 100 - (newTentatives.length - 1) * 15);
                    const newStats = {
                        victoires: stats.victoires + 1,
                        parties: stats.parties + 1,
                        meilleurScore: Math.max(stats.meilleurScore, score)
                    };
                    
                    saveStats(user.email, newStats);
                    
                    const updatedLobby = { ...lobby };
                    const joueurIdx = updatedLobby.joueurs.findIndex(j => j.email === user.email);
                    if (joueurIdx !== -1) {
                        updatedLobby.joueurs[joueurIdx].score += score;
                    }
                    storage.set(`lobby:${lobby.code}`, updatedLobby);
                    setLobby(updatedLobby);
                    
                    setGameOver(true);
                    showMessage(`üéâ Bravo! Trouv√© en ${newTentatives.length} essais! +${score} points`);
                } else if (newTentatives.length >= 6) {
                    const newStats = {
                        ...stats,
                        parties: stats.parties + 1
                    };
                    saveStats(user.email, newStats);
                    setGameOver(true);
                    showMessage(`Perdu! Le mot √©tait: ${partie.motSecret}`);
                }
            };

            const handleKeyPress = (lettre) => {
                if (gameOver) return;
                
                if (lettre === 'ENTER') {
                    submitGuess();
                } else if (lettre === 'BACK') {
                    setCurrentGuess(prev => prev.slice(0, -1));
                } else if (currentGuess.length < partie.longueur) {
                    setCurrentGuess(prev => prev + lettre);
                }
            };

            const HomePage = () => (
                <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                        <div className="text-center mb-8">
                            <h1 className="text-5xl font-bold text-gray-800 mb-2">WORDLE</h1>
                            <p className="text-gray-600">Multijoueur</p>
                        </div>
                        
                        <div className="space-y-4">
                            <button
                                onClick={() => setPage('register')}
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition"
                            >
                                S'inscrire
                            </button>
                            
                            <button
                                onClick={() => setPage('login')}
                                className="w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition"
                            >
                                Se connecter
                            </button>
                        </div>
                    </div>
                </div>
            );

            const RegisterPage = () => {
                const [formData, setFormData] = useState({ email: '', nom: '', prenom: '' });
                
                const handleSubmit = () => {
                    if (formData.email && formData.nom && formData.prenom) {
                        registerUser(formData.email, formData.nom, formData.prenom);
                    }
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-600 to-teal-700 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6">Inscription</h2>
                            
                            <div className="space-y-4">
                                <input
                                    type="email"
                                    placeholder="Email"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none"
                                />
                                <input
                                    type="text"
                                    placeholder="Nom"
                                    value={formData.nom}
                                    onChange={(e) => setFormData({...formData, nom: e.target.value})}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none"
                                />
                                <input
                                    type="text"
                                    placeholder="Pr√©nom"
                                    value={formData.prenom}
                                    onChange={(e) => setFormData({...formData, prenom: e.target.value})}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSubmit()}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none"
                                />
                                
                                <button
                                    onClick={handleSubmit}
                                    className="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg transition"
                                >
                                    Cr√©er mon compte
                                </button>
                            </div>
                            
                            <button
                                onClick={() => setPage('home')}
                                className="w-full mt-4 text-gray-600 hover:text-gray-800"
                            >
                                Retour
                            </button>
                        </div>
                    </div>
                );
            };

            const MenuPage = () => (
                <div className="min-h-screen bg-gradient-to-br from-purple-600 to-pink-700 p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 mb-6">
                            <div className="flex items-center justify-between mb-6">
                                <div>
                                    <h2 className="text-3xl font-bold text-gray-800">Bienvenue {user?.prenom}!</h2>
                                    <p className="text-gray-600">{user?.email}</p>
                                </div>
                                <button
                                    onClick={() => {
                                        setUser(null);
                                        setPage('home');
                                    }}
                                    className="text-red-600 hover:text-red-800"
                                >
                                    D√©connexion
                                </button>
                            </div>
                            
                            <div className="grid grid-cols-3 gap-4 mb-6">
                                <div className="bg-blue-100 p-4 rounded-lg text-center">
                                    <div className="text-2xl font-bold text-gray-800">{stats.victoires}</div>
                                    <div className="text-sm text-gray-600">Victoires</div>
                                </div>
                                <div className="bg-green-100 p-4 rounded-lg text-center">
                                    <div className="text-2xl font-bold text-gray-800">{stats.parties}</div>
                                    <div className="text-sm text-gray-600">Parties</div>
                                </div>
                                <div className="bg-yellow-100 p-4 rounded-lg text-center">
                                    <div className="text-2xl font-bold text-gray-800">{stats.meilleurScore}</div>
                                    <div className="text-sm text-gray-600">Meilleur Score</div>
                                </div>
                            </div>
                        </div>
                        
                        <div className="grid md:grid-cols-2 gap-6">
                            <button
                                onClick={() => setPage('createLobby')}
                                className="bg-white hover:bg-gray-50 rounded-2xl shadow-lg p-8 text-center transition"
                            >
                                <h3 className="text-2xl font-bold text-gray-800 mb-2">Cr√©er un Lobby</h3>
                                <p className="text-gray-600">Invitez vos amis √† jouer</p>
                            </button>
                            
                            <button
                                onClick={() => setPage('joinLobby')}
                                className="bg-white hover:bg-gray-50 rounded-2xl shadow-lg p-8 text-center transition"
                            >
                                <h3 className="text-2xl font-bold text-gray-800 mb-2">Rejoindre un Lobby</h3>
                                <p className="text-gray-600">Entrez un code de lobby</p>
                            </button>
                        </div>
                    </div>
                </div>
            );

            const CreateLobbyPage = () => {
                const [nomLobby, setNomLobby] = useState('');
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-600 to-blue-700 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6">Cr√©er un Lobby</h2>
                            
                            <input
                                type="text"
                                placeholder="Nom du lobby"
                                value={nomLobby}
                                onChange={(e) => setNomLobby(e.target.value)}
                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none mb-4"
                            />
                            
                            <button
                                onClick={() => nomLobby && createLobby(nomLobby)}
                                className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg transition mb-4"
                            >
                                Cr√©er
                            </button>
                            
                            <button
                                onClick={() => setPage('menu')}
                                className="w-full text-gray-600 hover:text-gray-800"
                            >
                                Retour
                            </button>
                        </div>
                    </div>
                );
            };

            const JoinLobbyPage = () => {
                const [code, setCode] = useState('');
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-teal-600 to-green-700 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                            <h2 className="text-3xl font-bold text-gray-800 mb-6">Rejoindre un Lobby</h2>
                            
                            <input
                                type="text"
                                placeholder="Code du lobby (6 chiffres)"
                                value={code}
                                onChange={(e) => setCode(e.target.value)}
                                maxLength={6}
                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-teal-500 focus:outline-none mb-4"
                            />
                            
                            <button
                                onClick={() => code.length === 6 && joinLobby(code)}
                                className="w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 rounded-lg transition mb-4"
                            >
                                Rejoindre
                            </button>
                            
                            <button
                                onClick={() => setPage('menu')}
                                className="w-full text-gray-600 hover:text-gray-800"
                            >
                                Retour
                            </button>
                        </div>
                    </div>
                );
            };

            const LobbyPage = () => (
                <div className="min-h-screen bg-gradient-to-br from-orange-600 to-red-700 p-4">
                    <div className="max-w-2xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-2xl p-8">
                            <div className="mb-6">
                                <h2 className="text-3xl font-bold text-gray-800 mb-2">{lobby.nom}</h2>
                                <div className="text-xl font-mono bg-gray-100 p-3 rounded-lg text-center">
                                    Code: <span className="font-bold text-orange-600">{lobby.code}</span>
                                </div>
                            </div>
                            
                            <div className="mb-6">
                                <h3 className="text-xl font-bold text-gray-700 mb-3">Joueurs ({lobby.joueurs.length})</h3>
                                <div className="space-y-2">
                                    {lobby.joueurs.map((joueur, idx) => (
                                        <div key={idx} className="bg-gray-50 p-3 rounded-lg flex justify-between items-center">
                                            <span className="font-semibold">{joueur.nom}</span>
                                            <span className="text-orange-600 font-bold">{joueur.score} pts</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            <button
                                onClick={startPartie}
                                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 rounded-lg transition mb-4"
                            >
                                D√©marrer la partie
                            </button>
                            
                            <button
                                onClick={() => {
                                    setLobby(null);
                                    setPage('menu');
                                }}
                                className="w-full text-gray-600 hover:text-gray-800"
                            >
                                Quitter le lobby
                            </button>
                        </div>
                    </div>
                </div>
            );

            const JeuPage = () => {
                const clavier = [
                    ['A', 'Z', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
                    ['Q', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L', 'M'],
                    ['ENTER', 'W', 'X', 'C', 'V', 'B', 'N', 'BACK']
                ];

                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-700 to-slate-900 p-4">
                        <div className="max-w-lg mx-auto">
                            <div className="bg-white rounded-2xl shadow-2xl p-6 mb-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-bold text-gray-800">WORDLE</h2>
                                    <div className="text-sm text-gray-600">
                                        Essai {tentatives.length + 1}/6
                                    </div>
                                </div>
                                
                                <div className="space-y-2 mb-6">
                                    {[...Array(6)].map((_, rowIdx) => (
                                        <div key={rowIdx} className="flex gap-2 justify-center">
                                            {[...Array(partie.longueur)].map((_, colIdx) => {
                                                const tentative = tentatives[rowIdx];
                                                const isCurrentRow = rowIdx === tentatives.length;
                                                const lettre = tentative ? tentative.mot[colIdx] : (isCurrentRow && currentGuess[colIdx]) || '';
                                                const etat = tentative ? tentative.correction[colIdx] : '';
                                                
                                                return (
                                                    <div
                                                        key={colIdx}
                                                        className={`w-14 h-14 border-2 rounded flex items-center justify-center text-2xl font-bold
                                                            ${etat === 'correct' ? 'bg-green-500 text-white border-green-500' : ''}
                                                            ${etat === 'present' ? 'bg-yellow-500 text-white border-yellow-500' : ''}
                                                            ${etat === 'absent' ? 'bg-gray-400 text-white border-gray-400' : ''}
                                                            ${!etat && lettre ? 'border-gray-400' : 'border-gray-300'}
                                                        `}
                                                    >
                                                        {lettre}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    ))}
                                </div>
                                
                                {gameOver && (
                                    <div className="mb-4 p-4 bg-blue-100 rounded-lg text-center">
                                        <button
                                            onClick={() => setPage('lobby')}
                                            className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg"
                                        >
                                            Retour au lobby
                                        </button>
                                    </div>
                                )}
                            </div>
                            
                            <div className="bg-white rounded-2xl shadow-2xl p-4">
                                <div className="space-y-2">
                                    {clavier.map((row, idx) => (
                                        <div key={idx} className="flex gap-1 justify-center">
                                            {row.map((lettre) => (
                                                <button
                                                    key={lettre}
                                                    onClick={() => handleKeyPress(lettre)}
                                                    disabled={gameOver}
                                                    className={`
                                                        ${lettre === 'ENTER' || lettre === 'BACK' ? 'px-4' : 'w-10'} 
                                                        h-12 bg-gray-300 hover:bg-gray-400 disabled:bg-gray-200 disabled:cursor-not-allowed
                                                        font-semibold rounded text-sm transition
                                                    `}
                                                >
                                                    {lettre === 'BACK' ? '‚Üê' : lettre}
                                                </button>
                                            ))}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="relative">
                    {message && (
                        <div className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-black text-white px-6 py-3 rounded-lg shadow-lg z-50">
                            {message}
                        </div>
                    )}
                    
                    {page === 'home' && <HomePage />}
                    {page === 'register' && <RegisterPage />}
                    {page === 'login' && <RegisterPage />}
                    {page === 'menu' && <MenuPage />}
                    {page === 'createLobby' && <CreateLobbyPage />}
                    {page === 'joinLobby' && <JoinLobbyPage />}
                    {page === 'lobby' && <LobbyPage />}
                    {page === 'jeu' && <JeuPage />}
                </div>
            );
        };

        ReactDOM.render(<WordleApp />, document.getElementById('root'));
    </script>
</body>
</html>